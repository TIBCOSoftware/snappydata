hydra.Prms-testRequirement = "Test to verify the basic policy creation/deletion functionality with JDBC client";
hydra.Prms-testDescription = "Test to verify the basic policy creation/deletion functionality with JDBC client";

INCLUDE $JTESTS/io/snappydata/hydra/security/startSnappyCluster.conf;

INITTASK    taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_executeSQLScripts
            io.snappydata.hydra.cluster.SnappyPrms-sqlScriptNames = create_and_load_columnTables_persistent.sql
            io.snappydata.hydra.cluster.SnappyPrms-dataLocation = ${dataFilesLocation}
            io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire2
            io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire2
            threadGroups = snappyThreads;

//GRANT select permissions
INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_performGrantRevokeCmd
           io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-isGrant = true
           io.snappydata.hydra.security.SnappySecurityPrms-onSchema = gemfire2.employees gemfire2.categories
           io.snappydata.hydra.security.SnappySecurityPrms-dmlOperations = SELECT
           threadGroups = snappyThreads;

//Create policies
INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_createPolicy
           io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-onSchema = gemfire2.employees gemfire2.categories
           io.snappydata.hydra.security.SnappySecurityPrms-dmlOperations = SELECT
           threadGroups = snappyThreads;

//Enable RLS
INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_enableRLS
           io.snappydata.hydra.security.SnappySecurityPrms-isAltTableRLS = true
           io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire2
           io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire2
           io.snappydata.hydra.security.SnappySecurityPrms-onSchema = gemfire2.employees gemfire2.categories
           threadGroups = snappyThreads;

//Verify policy creation by executing SELECT
INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_runQuery
           io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-dataLocation = ${dataLocation}
           io.snappydata.hydra.security.SnappySecurityPrms-onSchema = gemfire2.employees gemfire2.categories
           io.snappydata.hydra.security.SnappySecurityPrms-dmlOperations = SELECT
           io.snappydata.hydra.security.SnappySecurityPrms-isAltTableRLS = true
           io.snappydata.hydra.security.SnappySecurityPrms-isGrant = true
           threadGroups = snappyThreads;

//Disable RLS
INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_enableRLS
           io.snappydata.hydra.security.SnappySecurityPrms-isAltTableRLS = false
           io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire2
           io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire2
           io.snappydata.hydra.security.SnappySecurityPrms-onSchema = gemfire2.employees gemfire2.categories
           threadGroups = snappyThreads;

//Verify
INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_runQuery
           io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-dataLocation = ${dataLocation}
           io.snappydata.hydra.security.SnappySecurityPrms-onSchema = gemfire2.employees gemfire2.categories
           io.snappydata.hydra.security.SnappySecurityPrms-dmlOperations = SELECT
           io.snappydata.hydra.security.SnappySecurityPrms-isAltTableRLS = false
           io.snappydata.hydra.security.SnappySecurityPrms-isGrant = true
           threadGroups = snappyThreads;

//Drop policies
INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_dropPolicy
           io.snappydata.hydra.security.SnappySecurityPrms-isDropPolicy = true
           threadGroups = snappyThreads;

INITTASK   taskClass   = io.snappydata.hydra.security.SnappySecurityTest taskMethod  = HydraTask_runQuery
          io.snappydata.hydra.security.SnappySecurityPrms-isDropPolicy = true
           io.snappydata.hydra.security.SnappySecurityPrms-userName = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-passWord = gemfire3 gemfire4
           io.snappydata.hydra.security.SnappySecurityPrms-dataLocation = ${dataLocation}
           io.snappydata.hydra.security.SnappySecurityPrms-onSchema = gemfire2.employees gemfire2.categories
           io.snappydata.hydra.security.SnappySecurityPrms-dmlOperations = SELECT
           io.snappydata.hydra.security.SnappySecurityPrms-isGrant = true
           threadGroups = snappyThreads;


INCLUDE $JTESTS/io/snappydata/hydra/security/stopSnappyCluster.conf;

hydra.Prms-totalTaskTimeSec           = 100;
hydra.Prms-maxResultWaitSec           = 1800;

hydra.Prms-maxCloseTaskResultWaitSec  = 1800;
hydra.Prms-serialExecution            = true;

hydra.CachePrms-names = defaultCache;
sql.SQLPrms-useGfxdConfig = true;

io.snappydata.hydra.cluster.SnappyPrms-userAppJar = snappydata-store-scala-tests*tests.jar;
io.snappydata.hydra.cluster.SnappyPrms-shufflePartitions = 6;
io.snappydata.hydra.cluster.SnappyPrms-serverMemory = 4g;
io.snappydata.hydra.security.SnappySecurityPrms-isRLS = true;
io.snappydata.hydra.cluster.SnappyPrms-locatorLauncherProps += " -J-Dsnappydata.enable-rls=true ";
io.snappydata.hydra.cluster.SnappyPrms-serverLauncherProps += " -J-Dsnappydata.enable-rls=true ";
io.snappydata.hydra.cluster.SnappyPrms-leaderLauncherProps += " -J-Dsnappydata.enable-rls=true ";

<!DOCTYPE html >
<html>
        <head>
          <title>exchange - snappydata_2.11 1.1.0-HF-1 API - org.apache.spark.sql.execution.exchange</title>
          <meta name="description" content="exchange - snappydata 2.11 1.1.0 - HF - 1 API - org.apache.spark.sql.execution.exchange" />
          <meta name="keywords" content="exchange snappydata 2.11 1.1.0 HF 1 API org.apache.spark.sql.execution.exchange" />
          <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
          
      <link href="../../../../../../lib/template.css" media="screen" type="text/css" rel="stylesheet" />
      <link href="../../../../../../lib/diagrams.css" media="screen" type="text/css" rel="stylesheet" id="diagrams-css" />
      <script type="text/javascript" src="../../../../../../lib/jquery.js" id="jquery-js"></script>
      <script type="text/javascript" src="../../../../../../lib/jquery-ui.js"></script>
      <script type="text/javascript" src="../../../../../../lib/template.js"></script>
      <script type="text/javascript" src="../../../../../../lib/tools.tooltip.js"></script>
      
      <script type="text/javascript">
         if(top === self) {
            var url = '../../../../../../index.html';
            var hash = 'org.apache.spark.sql.execution.exchange.package';
            var anchor = window.location.hash;
            var anchor_opt = '';
            if (anchor.length >= 1)
              anchor_opt = '@' + anchor.substring(1);
            window.location.href = url + '#' + hash + anchor_opt;
         }
   	  </script>
    
        </head>
        <body class="value">
      <div id="definition">
        <img alt="Package" src="../../../../../../lib/package_big.png" />
        <p id="owner"><a href="../../../../../package.html" class="extype" name="org">org</a>.<a href="../../../../package.html" class="extype" name="org.apache">apache</a>.<a href="../../../package.html" class="extype" name="org.apache.spark">spark</a>.<a href="../../package.html" class="extype" name="org.apache.spark.sql">sql</a>.<a href="../package.html" class="extype" name="org.apache.spark.sql.execution">execution</a></p>
        <h1>exchange</h1><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      </div>

      <h4 id="signature" class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">package</span>
      </span>
      <span class="symbol">
        <span class="name">exchange</span>
      </span>
      </h4>
      
          <div id="comment" class="fullcommenttop"></div>
        

      <div id="mbrsel">
        <div id="textfilter"><span class="pre"></span><span class="input"><input id="mbrsel-input" type="text" accesskey="/" /></span><span class="post"></span></div>
        
        
        <div id="visbl">
            <span class="filtertype">Visibility</span>
            <ol><li class="public in"><span>Public</span></li><li class="all out"><span>All</span></li></ol>
          </div>
      </div>

      <div id="template">
        <div id="allMembers">
        

        <div id="types" class="types members">
              <h3>Type Members</h3>
              <ol><li name="org.apache.spark.sql.execution.exchange.BroadcastExchangeExec" visbl="pub" data-isabs="false" fullComment="no" group="Ungrouped">
      <a id="BroadcastExchangeExecextendsExchangewithProductwithSerializable"></a>
      <a id="BroadcastExchangeExec:BroadcastExchangeExec"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">case class</span>
      </span>
      <span class="symbol">
        <a href="BroadcastExchangeExec.html"><span class="name">BroadcastExchangeExec</span></a><span class="params">(<span name="mode">mode: <a href="../../catalyst/plans/physical/BroadcastMode.html" class="extype" name="org.apache.spark.sql.catalyst.plans.physical.BroadcastMode">BroadcastMode</a></span>, <span name="child">child: <a href="../SparkPlan.html" class="extype" name="org.apache.spark.sql.execution.SparkPlan">SparkPlan</a></span>)</span><span class="result"> extends <a href="Exchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.Exchange">Exchange</a> with <span class="extype" name="scala.Product">Product</span> with <span class="extype" name="scala.Serializable">Serializable</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@BroadcastExchangeExecextendsExchangewithProductwithSerializable" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      <p class="shortcomment cmt">A <a href="BroadcastExchangeExec.html" class="extype" name="org.apache.spark.sql.execution.exchange.BroadcastExchangeExec">BroadcastExchangeExec</a> collects, transforms and finally broadcasts the result of
a transformed SparkPlan.</p>
    </li><li name="org.apache.spark.sql.execution.exchange.EnsureRequirements" visbl="pub" data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="EnsureRequirementsextendsRule[org.apache.spark.sql.execution.SparkPlan]withProductwithSerializable"></a>
      <a id="EnsureRequirements:EnsureRequirements"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">case class</span>
      </span>
      <span class="symbol">
        <a href="EnsureRequirements.html"><span class="name">EnsureRequirements</span></a><span class="params">(<span name="conf">conf: <a href="../../internal/SQLConf.html" class="extype" name="org.apache.spark.sql.internal.SQLConf">SQLConf</a></span>)</span><span class="result"> extends <a href="../../catalyst/rules/Rule.html" class="extype" name="org.apache.spark.sql.catalyst.rules.Rule">Rule</a>[<a href="../SparkPlan.html" class="extype" name="org.apache.spark.sql.execution.SparkPlan">SparkPlan</a>] with <span class="extype" name="scala.Product">Product</span> with <span class="extype" name="scala.Serializable">Serializable</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@EnsureRequirementsextendsRule[org.apache.spark.sql.execution.SparkPlan]withProductwithSerializable" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      <p class="shortcomment cmt">Ensures that the <a href="../../catalyst/plans/physical/Partitioning.html" class="extype" name="org.apache.spark.sql.catalyst.plans.physical.Partitioning">Partitioning</a>
of input data meets the
<a href="../../catalyst/plans/physical/Distribution.html" class="extype" name="org.apache.spark.sql.catalyst.plans.physical.Distribution">Distribution</a> requirements for
each operator by inserting <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a> Operators where required.</p><div class="fullcomment"><div class="comment cmt"><p>Ensures that the <a href="../../catalyst/plans/physical/Partitioning.html" class="extype" name="org.apache.spark.sql.catalyst.plans.physical.Partitioning">Partitioning</a>
of input data meets the
<a href="../../catalyst/plans/physical/Distribution.html" class="extype" name="org.apache.spark.sql.catalyst.plans.physical.Distribution">Distribution</a> requirements for
each operator by inserting <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a> Operators where required.  Also ensure that the
input partition ordering requirements are met.
</p></div></div>
    </li><li name="org.apache.spark.sql.execution.exchange.Exchange" visbl="pub" data-isabs="true" fullComment="yes" group="Ungrouped">
      <a id="ExchangeextendsSparkPlanwithUnaryExecNode"></a>
      <a id="Exchange:Exchange"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier">abstract </span>
        <span class="kind">class</span>
      </span>
      <span class="symbol">
        <a href="Exchange.html"><span class="name">Exchange</span></a><span class="result"> extends <a href="../SparkPlan.html" class="extype" name="org.apache.spark.sql.execution.SparkPlan">SparkPlan</a> with <a href="../UnaryExecNode.html" class="extype" name="org.apache.spark.sql.execution.UnaryExecNode">UnaryExecNode</a></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@ExchangeextendsSparkPlanwithUnaryExecNode" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      <p class="shortcomment cmt">Base class for operators that exchange data among multiple threads or processes.</p><div class="fullcomment"><div class="comment cmt"><p>Base class for operators that exchange data among multiple threads or processes.</p><p>Exchanges are the key class of operators that enable parallelism. Although the implementation
differs significantly, the concept is similar to the exchange operator described in
&quot;Volcano -- An Extensible and Parallel Query Evaluation System&quot; by Goetz Graefe.
</p></div></div>
    </li><li name="org.apache.spark.sql.execution.exchange.ExchangeCoordinator" visbl="pub" data-isabs="false" fullComment="yes" group="Ungrouped">
      <a id="ExchangeCoordinatorextendsLogging"></a>
      <a id="ExchangeCoordinator:ExchangeCoordinator"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">class</span>
      </span>
      <span class="symbol">
        <a href="ExchangeCoordinator.html"><span class="name">ExchangeCoordinator</span></a><span class="result"> extends <span class="extype" name="org.apache.spark.internal.Logging">internal.Logging</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@ExchangeCoordinatorextendsLogging" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      <p class="shortcomment cmt">A coordinator used to determines how we shuffle data between stages generated by Spark SQL.</p><div class="fullcomment"><div class="comment cmt"><p>A coordinator used to determines how we shuffle data between stages generated by Spark SQL.
Right now, the work of this coordinator is to determine the number of post-shuffle partitions
for a stage that needs to fetch shuffle data from one or multiple stages.</p><p>A coordinator is constructed with three parameters, <code>numExchanges</code>,
<code>targetPostShuffleInputSize</code>, and <code>minNumPostShufflePartitions</code>.</p><ul><li><code>numExchanges</code> is used to indicated that how many <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a>s that will be registered
   to this coordinator. So, when we start to do any actual work, we have a way to make sure that
   we have got expected number of <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a>s.</li><li><code>targetPostShuffleInputSize</code> is the targeted size of a post-shuffle partition's
   input data size. With this parameter, we can estimate the number of post-shuffle partitions.
   This parameter is configured through
   <code>spark.sql.adaptive.shuffle.targetPostShuffleInputSize</code>.</li><li><code>minNumPostShufflePartitions</code> is an optional parameter. If it is defined, this coordinator
   will try to make sure that there are at least <code>minNumPostShufflePartitions</code> post-shuffle
   partitions.</li></ul><p>The workflow of this coordinator is described as follows:</p><ul><li>Before the execution of a <a href="../SparkPlan.html" class="extype" name="org.apache.spark.sql.execution.SparkPlan">SparkPlan</a>, for a <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a> operator,
   if an <a href="ExchangeCoordinator.html" class="extype" name="org.apache.spark.sql.execution.exchange.ExchangeCoordinator">ExchangeCoordinator</a> is assigned to it, it registers itself to this coordinator.
   This happens in the <code>doPrepare</code> method.</li><li>Once we start to execute a physical plan, a <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a> registered to this
   coordinator will call <code>postShuffleRDD</code> to get its corresponding post-shuffle
   <a href="../ShuffledRowRDD.html" class="extype" name="org.apache.spark.sql.execution.ShuffledRowRDD">ShuffledRowRDD</a>.
   If this coordinator has made the decision on how to shuffle data, this <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a>
   will immediately get its corresponding post-shuffle <a href="../ShuffledRowRDD.html" class="extype" name="org.apache.spark.sql.execution.ShuffledRowRDD">ShuffledRowRDD</a>.</li><li>If this coordinator has not made the decision on how to shuffle data, it will ask those
   registered <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a>s to submit their pre-shuffle stages. Then, based on the
   size statistics of pre-shuffle partitions, this coordinator will determine the number of
   post-shuffle partitions and pack multiple pre-shuffle partitions with continuous indices
   to a single post-shuffle partition whenever necessary.</li><li>Finally, this coordinator will create post-shuffle <a href="../ShuffledRowRDD.html" class="extype" name="org.apache.spark.sql.execution.ShuffledRowRDD">ShuffledRowRDD</a>s for all registered
   <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a>s. So, when a <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a> calls <code>postShuffleRDD</code>, this coordinator
   can lookup the corresponding <span class="extype" name="RDD">RDD</span>.</li></ul><p>The strategy used to determine the number of post-shuffle partitions is described as follows.
To determine the number of post-shuffle partitions, we have a target input size for a
post-shuffle partition. Once we have size statistics of pre-shuffle partitions from stages
corresponding to the registered <a href="ShuffleExchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.ShuffleExchange">ShuffleExchange</a>s, we will do a pass of those statistics and
pack pre-shuffle partitions with continuous indices to a single post-shuffle partition until
the size of a post-shuffle partition is equal or greater than the target size.
For example, we have two stages with the following pre-shuffle partition size statistics:
stage 1: [100 MB, 20 MB, 100 MB, 10MB, 30 MB]
stage 2: [10 MB,  10 MB, 70 MB,  5 MB, 5 MB]
assuming the target input size is 128 MB, we will have three post-shuffle partitions,
which are:</p><ul><li>post-shuffle partition 0: pre-shuffle partition 0 and 1</li><li>post-shuffle partition 1: pre-shuffle partition 2</li><li>post-shuffle partition 2: pre-shuffle partition 3 and 4
</li></ul></div></div>
    </li><li name="org.apache.spark.sql.execution.exchange.ReuseExchange" visbl="pub" data-isabs="false" fullComment="no" group="Ungrouped">
      <a id="ReuseExchangeextendsRule[org.apache.spark.sql.execution.SparkPlan]withProductwithSerializable"></a>
      <a id="ReuseExchange:ReuseExchange"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">case class</span>
      </span>
      <span class="symbol">
        <a href="ReuseExchange.html"><span class="name">ReuseExchange</span></a><span class="params">(<span name="conf">conf: <a href="../../internal/SQLConf.html" class="extype" name="org.apache.spark.sql.internal.SQLConf">SQLConf</a></span>)</span><span class="result"> extends <a href="../../catalyst/rules/Rule.html" class="extype" name="org.apache.spark.sql.catalyst.rules.Rule">Rule</a>[<a href="../SparkPlan.html" class="extype" name="org.apache.spark.sql.execution.SparkPlan">SparkPlan</a>] with <span class="extype" name="scala.Product">Product</span> with <span class="extype" name="scala.Serializable">Serializable</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@ReuseExchangeextendsRule[org.apache.spark.sql.execution.SparkPlan]withProductwithSerializable" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      <p class="shortcomment cmt">Find out duplicated exchanges in the spark plan, then use the same exchange for all the
references.</p>
    </li><li name="org.apache.spark.sql.execution.exchange.ReusedExchangeExec" visbl="pub" data-isabs="false" fullComment="no" group="Ungrouped">
      <a id="ReusedExchangeExecextendsSparkPlanwithLeafExecNodewithProductwithSerializable"></a>
      <a id="ReusedExchangeExec:ReusedExchangeExec"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">case class</span>
      </span>
      <span class="symbol">
        <a href="ReusedExchangeExec.html"><span class="name">ReusedExchangeExec</span></a><span class="params">(<span name="output">output: <a href="../../../../../../scala/package.html#Seq[+A]=Seq[A]" class="extmbr" name="scala.Seq">Seq</a>[<a href="../../catalyst/expressions/Attribute.html" class="extype" name="org.apache.spark.sql.catalyst.expressions.Attribute">Attribute</a>]</span>, <span name="child">child: <a href="Exchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.Exchange">Exchange</a></span>)</span><span class="result"> extends <a href="../SparkPlan.html" class="extype" name="org.apache.spark.sql.execution.SparkPlan">SparkPlan</a> with <a href="../LeafExecNode.html" class="extype" name="org.apache.spark.sql.execution.LeafExecNode">LeafExecNode</a> with <span class="extype" name="scala.Product">Product</span> with <span class="extype" name="scala.Serializable">Serializable</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@ReusedExchangeExecextendsSparkPlanwithLeafExecNodewithProductwithSerializable" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      <p class="shortcomment cmt">A wrapper for reused exchange to have different output, because two exchanges which produce
logically identical output will have distinct sets of output attribute ids, so we need to
preserve the original ids because they're what downstream operators are expecting.</p>
    </li><li name="org.apache.spark.sql.execution.exchange.ShuffleExchange" visbl="pub" data-isabs="false" fullComment="no" group="Ungrouped">
      <a id="ShuffleExchangeextendsExchangewithProductwithSerializable"></a>
      <a id="ShuffleExchange:ShuffleExchange"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">case class</span>
      </span>
      <span class="symbol">
        <a href="ShuffleExchange.html"><span class="name">ShuffleExchange</span></a><span class="params">(<span name="newPartitioning">newPartitioning: <a href="../../catalyst/plans/physical/Partitioning.html" class="extype" name="org.apache.spark.sql.catalyst.plans.physical.Partitioning">Partitioning</a></span>, <span name="child">child: <a href="../SparkPlan.html" class="extype" name="org.apache.spark.sql.execution.SparkPlan">SparkPlan</a></span>, <span name="coordinator">coordinator: <span class="extype" name="scala.Option">Option</span>[<a href="ExchangeCoordinator.html" class="extype" name="org.apache.spark.sql.execution.exchange.ExchangeCoordinator">ExchangeCoordinator</a>]</span>)</span><span class="result"> extends <a href="Exchange.html" class="extype" name="org.apache.spark.sql.execution.exchange.Exchange">Exchange</a> with <span class="extype" name="scala.Product">Product</span> with <span class="extype" name="scala.Serializable">Serializable</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@ShuffleExchangeextendsExchangewithProductwithSerializable" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      <p class="shortcomment cmt">Performs a shuffle that will result in the desired <code>newPartitioning</code>.</p>
    </li></ol>
            </div>

        

        <div id="values" class="values members">
              <h3>Value Members</h3>
              <ol><li name="org.apache.spark.sql.execution.exchange.BroadcastExchangeExec" visbl="pub" data-isabs="false" fullComment="no" group="Ungrouped">
      <a id="BroadcastExchangeExec"></a>
      <a id="BroadcastExchangeExec:BroadcastExchangeExec"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">object</span>
      </span>
      <span class="symbol">
        <a href="BroadcastExchangeExec$.html"><span class="name">BroadcastExchangeExec</span></a><span class="result"> extends <span class="extype" name="scala.Serializable">Serializable</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@BroadcastExchangeExec" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      
    </li><li name="org.apache.spark.sql.execution.exchange.ShuffleExchange" visbl="pub" data-isabs="false" fullComment="no" group="Ungrouped">
      <a id="ShuffleExchange"></a>
      <a id="ShuffleExchange:ShuffleExchange"></a>
      <h4 class="signature">
      <span class="modifier_kind">
        <span class="modifier"></span>
        <span class="kind">object</span>
      </span>
      <span class="symbol">
        <a href="ShuffleExchange$.html"><span class="name">ShuffleExchange</span></a><span class="result"> extends <span class="extype" name="scala.Serializable">Serializable</span></span>
      </span>
      </h4><span class="permalink">
      <a href="../../../../../../index.html#org.apache.spark.sql.execution.exchange.package@ShuffleExchange" title="Permalink" target="_top">
        <img src="../../../../../../lib/permalink.png" alt="Permalink" />
      </a>
    </span>
      
    </li></ol>
            </div>

        

        
        </div>

        <div id="inheritedMembers">
        
        
        </div>

        <div id="groupedMembers">
        <div class="group" name="Ungrouped">
              <h3>Ungrouped</h3>
              
            </div>
        </div>

      </div>

      <div id="tooltip"></div>

      <div id="footer">  </div>


    </body>
      </html>
